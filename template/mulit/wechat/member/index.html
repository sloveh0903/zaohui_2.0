<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>会员中心</title>
		<link rel="stylesheet" href="/public/mobile/css/mui.min.css" />
		<link rel="stylesheet" href="/public/mobile/css/global.css" />
		<link rel="stylesheet" href="/public/mobile/css/member.css" />		
		<script src="/public/mobile/js/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="/public/mobile/js/mui.min.js"></script>
		<script type="text/javascript" src="/public/mobile/js/globla.js"></script>
	</head>
	{include file="common/share" /}
	<body>
		<div class="head_top">
			<div class="headl">
				<img src="" class="face" />
				<div class="headl-right">
					{if $vip == 0}
					<p class="nickname"></p>
					{else}
					<p class="nickname"></p>
					{/if}
					{if $vip == 2}
					<p class="VIP_con">终身会员</p>
					{/if}
					{if $vip == 1}
					<p class="VIP_con">会员 {php}echo date('Y-m-d',$expire_time){/php}到期</p>
					{/if}
					{if $vip == -1}
					<p class="VIP_con">会员 {php}echo date('Y-m-d',$expire_time){/php}已到期</p>
					{/if}
					<!-- <span class="">VIP会员</span> -->
				</div>
			</div>
			<div class="headr">
				<div class="sign" id="sign" style="display: none;">
					<i><img src="/public/mobile/img/icon/sign@2x.png"/ alt="签到"></i>
					<span>签到</span>
				</div>
				<div class="signed" id="signed" style="display: none;">
					<span>已签到</span>
				</div>
			</div>
		</div>
		<div class="merber-1 mui-row font-color-6">
			<div>
				<span>完成课程</span>
				<span id="coursenum"></span>
			</div>
			<div id="jifen">
				<span>积分</span>
				<span id="point"></span>			
			</div>
			<div>
				<span>班级排名</span>
				<span id="ranking"></span>
			</div>
		</div>
		<div class="mui-row merber-2 font-color-6">
			<ul>
				<li>
					<i id="Monday"></i>
					<span>周一</span>
				</li>
				<li>
					<i id="Tuesday"></i>
					<span>周二</span>
				</li>
				<li>
					<i id="Wednesday"></i>
					<span>周三</span>
				</li>
				<li>
					<i id="Thursday"></i>
					<span>周四</span>
				</li>
				<li>
					<i id="Friday"></i>
					<span>周五</span>
				</li>
				<li>
					<i id="Saturday"></i>
					<span>周六</span>
				</li>
				<li>
					<i id="Sunday"></i>
					<span>周天</span>
				</li>
			</ul>
		</div>
		<div class="mui-row merber-list font-color-8">
			<ul class="iterm-box">
				{if $user_card}
				<li class="createVIP">
					<a href="{:url('/wechat/course/card')}" >
						<div class="iterm-img">
							<img src="/public/mobile/img/icon2/icon_vip@3x.png" alt="icon"/>
							<img src="" alt="icon" class="got-VIP" style="display: none;"/>
						</div>
						<div class="iterm-content">
							<span>我的VIP</span>	
							{if $vip == 0}
							<i class="open">开通VIP</i>
							{else}
							<i class="arrow mui-icon mui-icon-forward"></i>
							{/if}
						</div>	
					</a> 
				</li>
				{/if}
				<li>
					<a href="{:url('/wechat/member/order')}">
						<div class="iterm-img">
							<img src="/public/mobile/img/icon2/icon_bought@3x.png" alt="icon"/>
						</div>
						<div class="iterm-content">
							<span>已购买&nbsp;&nbsp;<span id="order"></span></span>
							<i class="mui-icon mui-icon-forward"></i>
						</div>
					</a>
				</li>
				<li>
					<a href="{:url('/wechat/member/ask')}">
						<div class="iterm-img">
							<img src="/public/mobile/img/icon2/icon_question@3x.png" alt="icon"/>
						</div>
						<div class="iterm-content">
							<span>我的提问&nbsp;&nbsp;<span id="ask"></span></span>
							<i class="mui-icon mui-icon-forward"></i>
						</div>
					</a>
				</li>
				<li>
					<a href="{:url('/wechat/member/answer')}">
						<div class="iterm-img">
							<img src="/public/mobile/img/icon2/icon_answer@3x.png" alt="icon"/>
						</div>
						<div class="iterm-content">
							<span>我的解答&nbsp;&nbsp;<span id="answer"></span></span>
							<i class="mui-icon mui-icon-forward"></i>
						</div>
					</a>
				</li>
				<li>
					<a href="{:url('/wechat/member/studylist')}">
						<div class="iterm-img">
							<img src="/public/mobile/img/icon2/icon_studyrecord@3x.png" alt="icon"/>
						</div>
						<div class="iterm-content">
							<span>学习记录</span>
							<i class="mui-icon mui-icon-forward"></i>
						</div>
					</a>
				</li>
				<li class="rebate" style="display: none">
					<a href="{:url('/wechat/rebate/index')}">
						<div class="iterm-img">
							<img src="/public/mobile/img/icon2/icon__distribution@3x.png" alt="icon"/>
						</div>
						<div class="iterm-content">
							<span>我的分销</span>
							<i class="mui-icon mui-icon-forward"></i>
						</div>
					</a>
				</li>
				<li>
					<a href="{:url('/wechat/member/setup')}">
						<div class="iterm-img">
							<img src="/public/mobile/img/icon2/icon_set@3x.png" alt="icon"/>
						</div>
						<div class="iterm-content">
							<span>设置</span>
							<i class="mui-icon mui-icon-forward"></i>
						</div>
					</a>
				</li>
			</ul>
		</div>
		<div class="grazy-copyright hastab">
			<i>格子匠 GRAZY.CN 技术支持</i>
	   </div>
	   <!--文本提示框-->
		<div class="toast-box limit">
			<div class="toast-main" id="toast-main"></div>
		</div>
		{include file="common/menu" /}
	</body>
<script type="text/javascript">

	document.getElementById('jifen').addEventListener('tap',function(){
		 window.location.href = "{:url('wechat/member/jifen')}"
	})

    var uid = '{$userinfo.uid}'; //用户id
    var isbind = '{$userinfo.is_bind}';
    var token = '{$userinfo.token}';
    var vip = '{$vip}';
	document.getElementById("sign").addEventListener('tap',function(){
		$.ajax({
	        url:host + 'integral/sign/',
	        data:{
	            uid:uid,
	            is_json:1
	        },
	        type:'GET', //GET
	        async:true,    //或false,是否异步
	        timeout:5000,    //超时时间
	        dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
	        success:function(data,textStatus,jqXHR){
	        	if(data.data.integral_code==1){
	        		var msg = data.data.msg;
	        		document.getElementById('toast-main').innerHTML=msg;
	        		toastBox();
	        		var point = parseInt($('#point').html())+data.data.integral;
	        	    $('#point').html(point);
	        		document.getElementById('sign').style.display='none';
	        		document.getElementById("signed").style.display='block';
	        	}
	        }
	    })
		
	});
    $.ajax({
        url:host + 'integral/checksign/',
        data:{
            uid:uid
        },
        type:'GET', //GET
        async:true,    //或false,是否异步
        timeout:5000,    //超时时间
        dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
        success:function(data,textStatus,jqXHR){
        	if(data.integral_code==1){
        		document.getElementById('sign').style.display='none';
        		document.getElementById("signed").style.display='block';
        	}else{
        		document.getElementById('sign').style.display='block';
        		document.getElementById("signed").style.display='none';
        	}
        }
    })
    
    $.ajax({
        url:host + 'user/center/index',
        data:{
            uid:uid,
            token:token
        },
        type:'GET', //GET
        async:true,    //或false,是否异步
        timeout:5000,    //超时时间
        dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
        success:function(data,textStatus,jqXHR){
        	if(data.code==-2){
        		mui.alert('token验证失败');
        		return false;
        	}
        	if(data.code==-3){
        		location.reload();
        	}
            if(data.code==1){
                var result = data.data;
                var studyinfo = "自"+result.study_begin+"学习了"+result.study_day+"天";
                var new_comment = "";
                if(result.user.is_rebate == 1){
                	$('.rebate').show();
                	//$('.head').hide();
                }
                $(".money").text(result.user.money);
                $(".face").attr('src',result.user.face);
                $('.bg').css("background","url("+result.user.face+") no-repeat center");
                if(Number(vip) > 0){
                    nk = result.user.nickname+'<span class="VIP_logo">VIP</span>';
                }else{
                    nk = result.user.nickname;
                }
                $(".nickname").html(nk);
                $(".studyinfo").html(studyinfo);
                $("#coursenum").html(result.study_complete);
                $("#point").html(result.user.now_integral);
                if(result.week.Monday){
                    $("#Monday").html("<em></em>");
                    $("#Monday").addClass('active');
				}
                if(result.week.Tuesday){
                    $("#Tuesday").html("<em></em>");
                    $("#Tuesday").addClass('active');
                }
                if(result.week.Wednesday){
                    $("#Wednesday").html("<em></em>");
                    $("#Wednesday").addClass('active');
                }
                if(result.week.Thursday){
                    $("#Thursday").html("<em></em>");
                    $("#Thursday").addClass('active');
                }
                if(result.week.Friday){
                    $("#Friday").html("<em></em>");
                    $("#Friday").addClass('active');
                }
                if(result.week.Saturday){
                    $("#Saturday").html("<em></em>");
                    $("#Saturday").addClass('active');
                }
                if(result.week.Sunday){
                    $("#Sunday").html("<em></em>");
                    $("#Sunday").addClass('active');
                }
                $("#ranking").html(result.ranking);
                $("#studytime").html(result.study_time);
                //$("#favorite").html(result.favorite_count);//收藏 去除
                $("#order").html(result.order_count);
                //$("#follow").html(result.follow);//关注去除
                $("#ask").html(result.ask_count);
                $("#answer").html(result.answer_count);
                // if(result.new_comments > 0){
                //     new_comment = result.new_comments+"条新回答";
                //     $("#new_comment").html(new_comment);
                //     $('#new_comment').next().addClass('red');
                // }


            }
        }
    })
	
</script>
	<script src="/public/mobile/js/bindmobile.js"></script>
</html>